# AI Git 提交工具使用指南

## 概述

`mygit` 是一个基于 AI 的智能 Git 提交工具，可以自动分析代码变更并生成高质量的中文提交信息。

## 功能特性

- 🤖 **AI 驱动**：使用 DeepSeek V3 等先进模型生成提交信息
- 📝 **中文优先**：生成符合中文习惯的提交信息
- 🔍 **智能分析**：自动分析代码变更，理解修改意图
- 🎨 **友好交互**：提供清晰的命令行界面和交互流程
- 🔒 **安全可靠**：敏感信息自动脱敏，日志记录完善
- ⚡ **快速高效**：一键完成 add、commit、push 全流程

## 安装配置

### 1. 配置 API 密钥

在项目根目录创建 `.env.mygit` 文件：

```bash
# 您的 API 密钥
DASHSCOPE_API_KEY=sk-your-api-key-here

# API 基础 URL (通常不需要修改)
DASHSCOPE_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1

# 使用的模型
DASHSCOPE_MODEL=deepseek-v3
```

### 2. 可用模型

- `deepseek-v3`: DeepSeek V3 模型（推荐）
- `qwen-vl-plus`: 通义千问视觉增强版
- `deepseek-r1`: DeepSeek R1 推理模型
- `deepseek-v3.2-exp`: DeepSeek V3.2 实验版

## 使用方法

### 基本用法

在项目根目录执行：

```bash
bun run mygit
```

### 工作流程

1. **检查变更**：工具会自动检测当前的代码变更
2. **显示摘要**：展示新增、修改、删除的文件列表
3. **生成提交信息**：AI 分析变更并生成提交信息
4. **确认提交**：用户确认或编辑提交信息
5. **执行提交**：自动执行 `git add .` 和 `git commit`
6. **推送远程**：可选择是否推送到远程仓库

### 交互示例

```
欢迎使用 AI Git 提交工具

⠋ 正在检查代码变更...

变更摘要：
  新增: 2 个文件
  修改: 3 个文件
  删除: 0 个文件

变更文件列表：
  + scripts/mygit/index.ts
  + scripts/mygit/ai-service.ts
  ~ scripts/mygit/git-service.ts
  ~ scripts/mygit/logger.ts
  ~ scripts/mygit/ui.ts

? 是否使用 AI 生成提交信息？ (y/n) [y]: y

⠋ 正在生成提交信息...

生成的提交信息：
──────────────────────────────────────────────────
feat: 实现 AI Git 提交工具核心功能

- 新增 AI 服务模块，支持调用 DeepSeek API 生成提交信息
- 新增 Git 服务模块，封装 git 命令操作
- 完善日志记录功能，支持敏感信息脱敏
- 优化用户交互界面，提供友好的命令行体验
──────────────────────────────────────────────────

? 是否使用此提交信息？ (y/n) [y]: y

⠋ 正在添加变更到暂存区...
✓ 变更已添加到暂存区

⠋ 正在创建提交...
✓ 提交创建成功

? 是否推送到远程仓库？ (y/n) [y]: y

⠋ 正在推送到远程仓库...
✓ 推送成功

✨ 所有操作完成！
```

## 日志记录

工具会自动记录详细的操作日志到 `logs/mygit.log` 文件，包括：

- 操作时间戳
- 日志级别（DEBUG、INFO、WARN、ERROR）
- 模块名称
- 操作详情
- 错误堆栈（如有）

日志文件会自动进行敏感信息脱敏处理，确保 API 密钥等信息不会泄露。

## 提交信息规范

生成的提交信息遵循以下规范：

1. **使用中文**：所有提交信息使用中文描述
2. **类型前缀**：使用标准的提交类型前缀
   - `feat`: 新功能
   - `fix`: 修复 bug
   - `docs`: 文档更新
   - `style`: 代码格式调整
   - `refactor`: 代码重构
   - `test`: 测试相关
   - `chore`: 构建/工具链相关
3. **简洁标题**：第一行不超过 50 字符
4. **详细说明**：必要时添加详细的变更说明

## 故障排查

### 问题：找不到 Git 仓库

**解决方案**：确保在 Git 仓库根目录执行命令

### 问题：API 调用失败

**解决方案**：
1. 检查 `.env.mygit` 文件是否存在
2. 确认 API 密钥是否正确
3. 检查网络连接是否正常
4. 查看 `logs/mygit.log` 获取详细错误信息

### 问题：没有检测到变更

**解决方案**：
1. 确认是否有未提交的变更
2. 执行 `git status` 查看当前状态

## 最佳实践

1. **定期提交**：保持小而频繁的提交，便于 AI 生成准确的提交信息
2. **检查生成结果**：虽然 AI 生成的提交信息通常很准确，但建议仍然检查一遍
3. **自定义编辑**：如果生成的提交信息不满意，可以选择手动编辑
4. **保护密钥**：确保 `.env.mygit` 文件已添加到 `.gitignore`

## 技术架构

- **运行时**：Bun
- **语言**：TypeScript
- **AI 模型**：DeepSeek V3 / 通义千问
- **Git 操作**：原生 git 命令
- **日志系统**：自定义日志模块，支持脱敏

## 相关文档

- [项目开发规则](../../.kiro/steering/project-rules.md)
- [日志配置指南](./logging-configuration.md)
- [快速开始](./quick-start.md)
