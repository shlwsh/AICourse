# 项目开发规则

## 语言规范

### 规则 1：中文优先
- **所有回复必须使用中文**
- **所有文档必须使用中文编写**，包括但不限于：
  - 需求文档（requirements.md）
  - 设计文档（design.md）
  - 任务列表（tasks.md）
  - README 文件
  - 代码注释
  - API 文档
  - 用户手册

## 技术栈规范

### 规则 2：使用 Bun 框架

本项目使用 Bun 作为 JavaScript/TypeScript 运行时和包管理器：

- **包管理**：使用 `bun add`、`bun remove` 等命令管理依赖，禁止使用 `npm` 或 `yarn`
- **脚本执行**：使用 `bun run` 执行脚本，禁止使用 `npm run`
- **包执行**：使用 `bunx` 执行包命令，禁止使用 `npx`
- **测试运行**：使用 `bunx playwright` 运行 Playwright 测试

**实施要求**：
- 所有 package.json 脚本必须使用 `bun` 命令
- 所有文档和脚本中的命令示例必须使用 `bun`
- Shell 脚本中使用 `bunx` 而不是 `npx`
- 不得在项目中混用 npm/yarn 和 bun

**示例**：
```bash
# 正确 ✓
bun add express
bun run dev
bunx playwright test

# 错误 ✗
npm install express
npm run dev
npx playwright test
```

## 日志记录规范

### 规则 3：完善的日志记录
所有模块必须实现完善的日志记录功能：

- **日志级别**：使用标准日志级别（DEBUG、INFO、WARN、ERROR）
- **日志内容**：记录关键操作、错误信息、性能指标
- **日志格式**：包含时间戳、日志级别、模块名称、消息内容
- **日志输出**：支持控制台输出和文件输出
- **敏感信息**：不得在日志中记录密码、密钥等敏感信息

**实施要求**：
- 每个模块/类都应该有独立的日志记录器
- 在关键业务逻辑的入口和出口处添加日志
- 异常处理时必须记录详细的错误信息和堆栈跟踪
- 重要的状态变更必须记录日志

## 测试规范

### 规则 4：使用 Playwright 进行前端和集成测试

- **前端测试**：使用 Playwright 框架进行 UI 测试
- **集成测试**：使用 Playwright 框架进行端到端测试
- **测试覆盖**：确保关键用户流程都有对应的测试用例

**Playwright 测试要求**：
- 测试文件命名：`*.spec.ts` 或 `*.test.ts`
- 使用 Page Object Model 模式组织测试代码
- 测试应该独立且可重复执行
- 使用有意义的测试描述
- 适当使用等待和断言确保测试稳定性

### 规则 5：集成测试执行流程

**顺序执行与错误处理**：
- **按用例顺序执行**：集成测试必须按照预定义的用例顺序依次执行
- **快速失败机制**：一旦某个用例执行失败，立即停止后续测试
- **进入修正流程**：测试失败后，必须：
  1. 分析失败原因并记录详细日志
  2. 修正代码或测试用例
  3. 重新运行失败的用例进行验证
  4. 确认修正通过后，才能继续执行下一个用例
- **验证通过标准**：只有当前用例完全通过（所有断言成功），才能进入下一个用例

**实施要求**：
- 测试用例应该有明确的执行顺序编号
- 每个用例执行前记录开始日志，执行后记录结果
- 失败时输出清晰的错误信息和失败位置
- 修正后必须从失败的用例重新开始执行
- 不允许跳过失败的用例继续执行后续测试

## 架构规范

### 规则 6：前后端分离架构

本项目采用前后端分离架构，所有业务逻辑通过 Hono 后端服务实现：

**架构原则**：
- **前端**：Vue 3 + TypeScript，负责 UI 展示和用户交互
- **后端**：Bun + Hono，负责所有业务逻辑、数据处理、算法实现
- **数据库**：SQLite，统一的数据持久化层
- **Tauri**：仅作为桌面应用打包工具，不实现业务逻辑

**实施要求**：
- 所有业务逻辑必须在 Hono 后端服务中实现（`src-service/` 目录）
- 前端通过 HTTP API 调用后端服务（`src/api/` 目录）
- Tauri 仅用于桌面应用发布，不包含业务代码
- `src-tauri/` 目录只保留最小化的 Tauri 配置和启动代码

**禁止的做法**：
- ❌ 在 Tauri 命令中实现业务逻辑
- ❌ 在前端直接操作数据库
- ❌ 在 Tauri 中实现算法或数据处理
- ❌ 混合使用 Tauri API 和 HTTP API 实现同一功能

**正确的做法**：
- ✅ 业务逻辑在 `src-service/` 中实现
- ✅ 前端通过 `src/api/` 调用后端 API
- ✅ Tauri 仅作为应用容器，加载前端页面
- ✅ 所有数据操作通过后端 API 完成

## 运行环境规范

### 规则 7：开发与生产环境

**开发环境**：
- **默认启动命令**：`bun run dev`
- **启动内容**：前端开发服务器 + 后端 Hono 服务
- **前端地址**：http://localhost:5173
- **后端地址**：http://localhost:3000
- **Tauri**：开发阶段默认不启动，需要时使用 `bun run tauri dev`

**生产环境**：
- **浏览器模式**：直接访问部署的 Web 应用
- **桌面应用模式**：通过 Tauri 打包的桌面应用
- **数据流**：前端 → Hono 后端 → SQLite 数据库

**实施要求**：
- 开发时优先使用浏览器模式（更快、更方便调试）
- Tauri 仅在需要测试桌面应用特性时启动
- 所有功能必须在浏览器模式下完全可用
- 桌面应用仅是 Web 应用的打包形式，不增加额外功能

**package.json 脚本规范**：
```json
{
  "dev": "并发启动前端和后端服务",
  "dev:frontend": "启动前端开发服务器",
  "dev:service": "启动后端 Hono 服务",
  "tauri:dev": "启动 Tauri 桌面应用（可选）"
}
```

## 文档规范

### 规则 8：专注代码开发，避免过度文档化

- **非必要不生成文档**：除非用户明确要求，否则不要自动生成 Markdown 文档
- **禁止生成的文档类型**：
  - 工作总结文档（summary.md、report.md 等）
  - 实现过程记录文档
  - 变更日志文档（除非是项目级别的 CHANGELOG.md）
  - 临时性的说明文档
- **允许生成的文档**：
  - 用户明确要求的文档
  - 项目必需的 README.md
  - API 文档（当实现新的 API 时）
  - 架构设计文档（当进行重大架构变更时）

**实施要求**：
- 完成任务后，直接给出简短的文字总结，不要创建 Markdown 文件
- 代码注释应该清晰完整，减少对外部文档的依赖
- 专注于代码质量和功能实现，而非文档数量

---

**注意**：这些规则适用于整个项目的开发过程，所有代码、文档和测试都必须遵循以上规范。
